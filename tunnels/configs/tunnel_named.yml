# Named Cloudflare Tunnel
# Комманда для запуска:
#   cloudflared tunnel --config ./tunnels/configs/tunnel_named.yml run

tunnel: 7cccb0e3-ebc4-4ec8-bc5c-90ec034f8115
credentials-file: /home/parkens/.cloudflared/7cccb0e3-ebc4-4ec8-bc5c-90ec034f8115.json

# Сети/стек: принудительно TCP/h2 и IPv4 — стабильнее в WSL2/моб. сетях
protocol: http2
edge-ip-version: 4

# Логирование и метрики (удобно для отладки/наблюдения)
loglevel: info
logfile: ./tunnels/logs/tunnel_named.log   # создай папку tunnels/logs
metrics: 127.0.0.1:8081                    # локальные метрики (Prometheus)

# Автообновления иногда “роняют” процесс в WSL2 — лучше отключить
no-autoupdate: true

# Дефолтные настройки для ВСЕХ ingress (перекрываются на уровне конкретного правила)
originRequest:
  connectTimeout: 10s
  tlsTimeout: 10s
  tcpKeepAlive: 30s
  keepAliveConnections: 100
  keepAliveTimeout: 30s
  http2Origin: false
  disableChunkedEncoding: true

ingress:
  # 1) Основной путь: пробрасываем домен на локальный nginx
  - hostname: proxy.ters-team.com
    service: http://localhost:8080

  # 2) Healthcheck-хост (удобно для внешних проверок, не трогая основной домен)
  - hostname: status.proxy.ters-team.com
    service: http_status:200

  # 3) Фолбэк
  - service: http_status:404