# Принятые решения (Decision Log)

Формат: **ADR-XXX** — Краткое название — Решение — Причина — Альтернативы — Статус.

---

**ADR-001 — Cloudflare как первый слой (DNS/CDN)**
- Решение: Перенести зону в Cloudflare и включить proxy.
- Причина: Быстрый тест доступности из КНР/РФ через глобальный edge.
- Альтернативы: Оставаться на Wix DNS; сразу идти в Netlify DNS.
- Статус: Выполнено, частично помогло (затем проблемы у мобильных операторов РФ).

**ADR-002 — Принудительный IPv4 на уровне Nginx**
- Решение: `resolver ... ipv6=off;` + `proxy_ssl_server_name on;` + корректные `Host`/`X-Forwarded-*`.
- Причина: Ошибки `connect() failed (101)` при попытке IPv6 к upstream.
- Альтернативы: Включение системного IPv6; туннелирование IPv6.
- Статус: Выполнено, локальный proxy стабилен, необходима проверка через публичный доступ.

**ADR-003 — Cloudflare Tunnel: HTTP/2 и IPv4**
- Решение: `cloudflared ... --protocol http2 --edge-ip-version 4`.
- Причина: QUIC/UDP/IPv6 нестабилен (WSL2, мобильные сети).
- Альтернативы: Оставаться на QUIC; настраивать UDP в сети.
- Статус: Выполнено, но с мобильных сетей долго/недоступно

**ADR-004 — Netlify как зеркало (iframe)**
- Решение: Подключить `ru.ters-team.com` на Netlify; iframe на основной сайт.
- Причина: Доступность из РФ.
- Альтернативы: Полный reverse-proxy на Netlify Edge Functions; VPS.
- Статус: Выполнено, но частично: скорость/картинки/SEO — ограничения iframe.

**ADR-005 — Перенос NS на Netlify DNS + настройка Edge Function**
- Решение: Делегировать NS к Netlify NSONE, затем деплоить конфиг Edge Function для полного revers proxy.
- Причина: Необходимо сделать унифицированный доступ к сайту через основной домен для сохранения корректного SEO
- Альтернативы: использовать иные CDN.
- Статус: Выполнено частично, Edge Functions ломается/некорректно тянет контент с оригинального сайта на Wix.

**ADR-006 — Отказ от Netlify + возврат на Wix**
- Решение: Остановка варианта с Edge Function на Netlify, возврат на Wix из-за фильтрации Netlify - GFW.
- Причина: Netlify частично блокируется в КНР (RST/DNS poisoning).
- Альтернативы: Продолжать с Netlify без территори Материкового Китая.
- Статус: Возврат на Wix завершён.

**ADR-007 — Целевая стратегия: VPS + собственный reverse-proxy**
- Решение: Развернуть Docker/K8s-proxy в нейтральной локации (Сингапур/Турция/Казахстан).
- Причина: Контроль маршрутизации, гибкость, ниже риски блокировок.
- Альтернативы: Managed CDN-решения с China Network (дороже, сложнее).
- Статус: В работе (локальные тесты → туннель → VPS).